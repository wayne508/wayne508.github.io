<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="Live your dream and share your passion!"><title>使用Java反射解析JSON配置文件 | Wayne's Blog</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/6.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.2/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.2/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">使用Java反射解析JSON配置文件</h1><a id="logo" href="/.">Wayne's Blog</a><p class="description"></p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">使用Java反射解析JSON配置文件</h1><div class="post-meta">Jan 6, 2015<script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> 阅读</span></span></div><div class="post-content"><h2 id="什么是JSON"><a href="#什么是JSON" class="headerlink" title="什么是JSON"></a>什么是JSON</h2><p>JSON(JavaScript Object Notation)是指Javascript对象表示法。JSON是Javascript的一个子集，但JSON是一种独立的文本格式，用来存储和交换文本信息的语法。类似 XML。详细介绍可以参见<a href="http://www.json.org/json-zh.html" target="_blank" rel="external">介绍JSON</a>。</p>
<p>对于动态语言比如Javascript、Python来说，解析JSON属于小菜一碟；但对于静态强类型语言来说，解析JSON要费点功夫。尽管Java解析JSON比较麻烦，幸运的是，Java已经有很多强大的JSON解析器。</p>
<h2 id="解析工具"><a href="#解析工具" class="headerlink" title="解析工具"></a>解析工具</h2><p>本文使用org.json来解析JSON数据。org.json是非常轻量级的JSON解析器，不依赖于其他库。</p>
<p>JSON有两种数据类型：对象和数组。</p>
<ul>
<li>对象：通过花括号包含的键/值对</li>
<li>数组：通过方括号包含的有序列表</li>
</ul>
<p>这两种类型分别对应于org.json的JSONObject和JSONArray。</p>
<h2 id="解析思路"><a href="#解析思路" class="headerlink" title="解析思路"></a>解析思路</h2><p>需求：将配置文件中的JSON字符串转换为某个实例（比如自定义的Config类或Map）。</p>
<p>分析：  </p>
<ol>
<li>生成的“某个实例”到底是哪一个呢？可以增加一个输入参数<code>Class&lt;?&gt;</code>，表示生成实例的类型。</li>
<li>如果指定的类型不是Map，那么这个类型必须要包含JSON所有键所对应的域。比如JSON对象为<code>{&quot;name&quot; : &quot;Tim&quot;, &quot;age&quot; : 20}</code>，那么指定的类型必须包含String类型的name域和数值类型的age域。</li>
</ol>
<ul>
<li>输入：1. JSON字符串或者代表JSON字符串的JSONObject；2. <code>Class&lt;?&gt;</code>表示生成实例的类型</li>
<li>输出：对应的实例</li>
</ul>
<h3 id="第1步"><a href="#第1步" class="headerlink" title="第1步"></a>第1步</h3><p>如果定义一个函数<code>json2obj</code>来操作，函数的返回类型与<code>Class&lt;?&gt;</code>输入参数有关，不是固定的，所以可以采用泛型。那么<code>json2obj</code>的框架可以这么写：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">public &lt;T&gt; T json2obj(JSONObject json, Class&lt;T&gt; Cls) &#123;</div><div class="line">	...</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="第2步"><a href="#第2步" class="headerlink" title="第2步"></a>第2步</h3><p>现在可以想一个大致的步骤了：如果指定的类型是Map或其子类，那么就将JSON转化为Map实例（JSON的键/值对可以对应于Map的键/值对）；否则，根据Class参数生成对应实例，将JSON中的键/值对填入到该实例对应的域中，这显然得用到反射。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">public &lt;T&gt; T json2obj(JSONObject json, Class&lt;T&gt; Cls) &#123;</div><div class="line">	if (Map.class.isAssignableFrom(Cls)) &#123;</div><div class="line">    	T map = 解析json到map;</div><div class="line">		return map;</div><div class="line">    &#125;</div><div class="line">    T res = Cls.newInstance();</div><div class="line">    Iterator&lt;String&gt; iter = json.keys();</div><div class="line">    while (iter.hasNext()) &#123;</div><div class="line">		key = iter.next();</div><div class="line">		value = json.get(key);</div><div class="line">        设置res对应于key的域</div><div class="line">    &#125;</div><div class="line">    return res</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="第3步"><a href="#第3步" class="headerlink" title="第3步"></a>第3步</h3><p>先将JSON转化为Map实例，这个比较容易：定义一个新的函数<code>json2map</code>，将JSON的键值对逐个填入到map实例中，并修改原来的<code>json2obj</code>函数。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">private Map&lt;String, Object&gt; json2map(JSONObject json,</div><div class="line">			Class&lt;Map&lt;String, Object&gt;&gt; mapCls) &#123;</div><div class="line">	Map&lt;String, Object&gt; map = mapCls.newInstance();</div><div class="line">	Iterator&lt;String&gt; iter = json.keys();</div><div class="line">	String key;</div><div class="line">	while (iter.hasNext()) &#123;</div><div class="line">		key = iter.next();</div><div class="line">		map.put(key, json.get(key));</div><div class="line">	&#125;</div><div class="line">	return map;</div><div class="line">&#125;</div><div class="line"></div><div class="line">public &lt;T&gt; T json2obj(JSONObject json, Class&lt;T&gt; Cls) &#123;</div><div class="line">	if (Map.class.isAssignableFrom(Cls)) &#123;</div><div class="line">    	return (T)json2map(json, (Class&lt;Map&lt;String, Object&gt;&gt;) Cls);</div><div class="line">    &#125;</div><div class="line">    T res = Cls.newInstance();</div><div class="line">    Iterator&lt;String&gt; iter = json.keys();</div><div class="line">    while (iter.hasNext()) &#123;</div><div class="line">		key = iter.next();</div><div class="line">		value = json.get(key);</div><div class="line">        设置res对应于key的域</div><div class="line">    &#125;</div><div class="line">    return res</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="第4步"><a href="#第4步" class="headerlink" title="第4步"></a>第4步</h3><p>现在考虑普通实例的转换。如果key对应的value是普通类型，即字符串或数值，那么直接把值填写到对应的域中即可；如果value是对象（JSONObject），那么把value转化为对应域类型的实例，递归地调用json2obj函数。</p>
<p>接下来设置key对应的域：如果这个域是public的，直接设置；否则通过对应的setter方法设置。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">   ...</div><div class="line">while (iter.hasNext()) &#123;</div><div class="line">key = iter.next();</div><div class="line">value = json.get(key);</div><div class="line">      Field field = Cls.getDeclaredField(key);</div><div class="line">// recursion</div><div class="line">if (value instanceof JSONObject)</div><div class="line">	value = json2obj((JSONObject) value, field.getType());</div><div class="line">      if (Modifier.isPublic(field.getModifiers())) &#123;</div><div class="line">	field.setAccessible(true);</div><div class="line">	field.set(res, value);</div><div class="line">&#125; else &#123; // not accessible, use setter method</div><div class="line">	String methodName = &quot;set&quot; + Character.toUpperCase(key.charAt(0)) + key.substring(1);</div><div class="line">	Method setMethod = Cls.getMethod(methodName, field.getType());</div><div class="line">	setMethod.invoke(res, value);</div><div class="line">&#125;</div><div class="line">  &#125;</div><div class="line">   ...</div></pre></td></tr></table></figure>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>本文主要通过反射将JSON转化为Java实例，实例类型由输入参数<code>Class&lt;T&gt; Cls</code>决定，可以是Map类或者普通类。如果Java类是普通类，必须包含JSON对象所有键（key）所对应的同名同类型域，且可设置（public或者setter方法）。比如JSON包含名为”name”的key，那么Java类也应该包含name的域。JSON对象内也可以包含JSON对象，Java类内部也必须包含其他Java类型的域。程序通过递归的方式解析。</p>
<p>本文没有考虑JSON数组的转化。</p>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="http://yoursite.com/2015/01/06/使用Java反射解析JSON配置文件/" data-id="cj2v83kxb000gcsx4n17kj77u" class="article-share-link">分享</a><div class="tags"><a href="/tags/java/">java</a><a href="/tags/反射/">反射</a><a href="/tags/json/">json</a></div><div class="post-nav"><a href="/2015/01/13/Floodlight源码分析（1）/" class="pre">Floodlight源码分析（1）</a><a href="/2014/12/27/社区划分-Newman快速算法/" class="next">社区划分-Newman快速算法</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://yoursite.com"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/python/" style="font-size: 15px;">python</a> <a href="/tags/java/" style="font-size: 15px;">java</a> <a href="/tags/floodlight/" style="font-size: 15px;">floodlight</a> <a href="/tags/leetcode/" style="font-size: 15px;">leetcode</a> <a href="/tags/c/" style="font-size: 15px;">c++</a> <a href="/tags/算法/" style="font-size: 15px;">算法</a> <a href="/tags/图论/" style="font-size: 15px;">图论</a> <a href="/tags/git/" style="font-size: 15px;">git</a> <a href="/tags/sdn/" style="font-size: 15px;">sdn</a> <a href="/tags/os/" style="font-size: 15px;">os</a> <a href="/tags/linux/" style="font-size: 15px;">linux</a> <a href="/tags/反射/" style="font-size: 15px;">反射</a> <a href="/tags/json/" style="font-size: 15px;">json</a> <a href="/tags/最优化/" style="font-size: 15px;">最优化</a> <a href="/tags/c/" style="font-size: 15px;">c</a> <a href="/tags/翻译/" style="font-size: 15px;">翻译</a> <a href="/tags/jvm/" style="font-size: 15px;">jvm</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/05/18/hello-world/">Hello World</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/08/20/ucore源码分析：bootloader/">ucore源码分析：bootloader</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/08/13/基于SDN的简单load-balancer/">基于SDN的简单load balancer</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/07/09/git使用/">git使用</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/06/09/python监控网卡流量/">python监控网卡流量</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/03/19/LeetCode-Median-of-Two-Sorted-Arrays/">[LeetCode]Median of Two Sorted Arrays</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/03/12/译-管理堆空间：使用JVMTI循环类实例/">[译]管理堆空间：使用JVMTI循环类实例</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/01/23/社区划分-Laplace矩阵与谱划分算法/">社区划分-Laplace矩阵与谱划分算法</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/01/14/ServiceLoader的使用/">ServiceLoader的使用</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/01/13/Floodlight源码分析（1）/">Floodlight源码分析（1）</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2017 <a href="/." rel="nofollow">Wayne's Blog.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a>Theme - <a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> maupassant.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.0.47/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.0.47/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>